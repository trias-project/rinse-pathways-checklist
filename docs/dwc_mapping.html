<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Lien Reyserhove" />
<meta name="author" content="Peter Desmet" />

<meta name="date" content="2018-06-27" />

<title>Darwin Core mapping</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="static/css/trias.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}

.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">rinse-pathways-checklist</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="dwc_mapping.html">Darwin Core mapping</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/trias-project/rinse-pathways-checklist">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Darwin Core mapping</h1>
<h3 class="subtitle"><em>For: RINSE - Pathways and vectors of biological invasions in Northwest Europe</em></h3>
<h4 class="author"><em>Lien Reyserhove</em></h4>
<h4 class="author"><em>Peter Desmet</em></h4>
<h4 class="date"><em>2018-06-27</em></h4>

</div>


<p>This document describes how we map the checklist data to Darwin Core. The source file for this document can be found <a href="https://github.com/trias-project/rinse-pathways-checklist/blob/master/src/dwc_mapping.Rmd">here</a>.</p>
<div id="setup" class="section level1">
<h1><span class="header-section-number">1</span> Setup</h1>
<p>Set locale (so we use UTF-8 character encoding):</p>
<pre class="r"><code># This works on Mac OS X, might not work on other OS
Sys.setlocale(&quot;LC_CTYPE&quot;, &quot;en_US.UTF-8&quot;)</code></pre>
<pre><code>## [1] &quot;en_US.UTF-8&quot;</code></pre>
<p>Load libraries:</p>
<pre class="r"><code>library(tidyverse) # To transform data
library(magrittr)  # For %&lt;&gt;% pipes
library(janitor)   # To clean input data
library(readxl)    # To read Excel files
library(stringr)   # To perform string operations
library(digest)    # To generate hashes
library(rgbif)     # To parse names
library(purrr)     # To clean references</code></pre>
<p>Set file paths (all paths should be relative to this script):</p>
<pre class="r"><code># Raw files:
raw_data_file = &quot;../data/raw/transcribed_10530_2016_1278_MOESM2_ESM.xlsx&quot;
references = &quot;../data/raw/transcribed_references.xlsx&quot;

# Processed files:
dwc_taxon_file = &quot;../data/processed/taxon.csv&quot;
dwc_literature_references_file = &quot;../data/processed/references.csv&quot;
dwc_distribution_file = &quot;../data/processed/distribution.csv&quot;
dwc_profile_file = &quot;../data/processed/speciesprofile.csv&quot;
dwc_description_file = &quot;../data/processed/description.csv&quot;</code></pre>
</div>
<div id="read-and-pre-process-raw-data" class="section level1">
<h1><span class="header-section-number">2</span> Read and pre-process raw data</h1>
<p>Create a data frame <code>raw_data</code> from the source data:</p>
<pre class="r"><code>raw_data &lt;- read_excel(path = raw_data_file) </code></pre>
<p>Clean the data somewhat: remove empty rows if present and clean names:</p>
<pre class="r"><code>raw_data %&lt;&gt;% 
  remove_empty(&quot;rows&quot;) %&lt;&gt;%
  clean_names()</code></pre>
<div id="generate-taxonid" class="section level2">
<h2><span class="header-section-number">2.1</span> Generate taxonID</h2>
<p>To uniquely identify a taxon in the taxon core and reference taxa in the extensions, we need a <code>taxonID</code>. Since we need it in all generated files, we generate it here in the raw data frame. It is a combination of <code>dataset-shortname:taxon:</code> and a hash based on the scientific name. As long as the scientific name doesn’t change, the ID will be stable. Some of the names require some minor cleaning first though:</p>
<pre class="r"><code>raw_data %&lt;&gt;% mutate(species_clean = case_when(
  species == &quot;Crassostrea rhizophoraeGuilding 1828&quot; ~ &quot;Crassostrea rhizophorae Guilding 1828&quot;,
  species == &quot;Petricola pholadiformisLamarck, 1818&quot; ~ &quot;Petricola pholadiformis Lamarck, 1818&quot;,
  species == &quot;Theba pisanaMüller, 1774)&quot; ~ &quot;Theba pisana (Müller, 1774)&quot;,
  species == &quot;Maylandia sp. M. K. Meyer &amp; W. Förster, 1984&quot; ~ &quot;Maylandia M. K. Meyer &amp; W. Förster, 1984&quot;,
  TRUE ~ species)) </code></pre>
<p>Generate <code>taxonID</code>:</p>
<pre class="r"><code># Vectorize the digest function (the digest() function isn&#39;t vectorized. So if you pass in a vector, you get one value for the whole vector rather than a digest for each element of the vector):
vdigest &lt;- Vectorize(digest)

# Generate taxonID:
raw_data %&lt;&gt;% mutate(taxonID = paste(&quot;rinse-pathways-checklist&quot;, &quot;taxon&quot;, vdigest (species_clean, algo = &quot;md5&quot;), sep = &quot;:&quot;))</code></pre>
</div>
<div id="further-pre-processing" class="section level2">
<h2><span class="header-section-number">2.2</span> Further pre-processing</h2>
<p>Add prefix <code>raw_</code> to all column names to avoid name clashes with Darwin Core terms:</p>
<pre class="r"><code>colnames(raw_data) &lt;- paste0(&quot;raw_&quot;, colnames(raw_data))</code></pre>
<p>Preview data:</p>
<pre class="r"><code>raw_data %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_species"],"name":[1],"type":["chr"],"align":["left"]},{"label":["raw_higher_classification"],"name":[2],"type":["chr"],"align":["left"]},{"label":["raw_established_gb"],"name":[3],"type":["chr"],"align":["left"]},{"label":["raw_established_france"],"name":[4],"type":["chr"],"align":["left"]},{"label":["raw_established_belgium"],"name":[5],"type":["chr"],"align":["left"]},{"label":["raw_established_netherlands"],"name":[6],"type":["chr"],"align":["left"]},{"label":["raw_first_record_gb"],"name":[7],"type":["chr"],"align":["left"]},{"label":["raw_first_record_france"],"name":[8],"type":["chr"],"align":["left"]},{"label":["raw_first_record_belgium"],"name":[9],"type":["chr"],"align":["left"]},{"label":["raw_first_record_netherlands"],"name":[10],"type":["chr"],"align":["left"]},{"label":["raw_origin"],"name":[11],"type":["chr"],"align":["left"]},{"label":["raw_pathway_import_release"],"name":[12],"type":["chr"],"align":["left"]},{"label":["raw_pathway_import_escape"],"name":[13],"type":["chr"],"align":["left"]},{"label":["raw_pathway_accidental"],"name":[14],"type":["chr"],"align":["left"]},{"label":["raw_pathway_dispersal"],"name":[15],"type":["chr"],"align":["left"]},{"label":["raw_vector_ornamental"],"name":[16],"type":["chr"],"align":["left"]},{"label":["raw_vector_leisure"],"name":[17],"type":["chr"],"align":["left"]},{"label":["raw_vector_industry"],"name":[18],"type":["chr"],"align":["left"]},{"label":["raw_vector_biocontrol"],"name":[19],"type":["chr"],"align":["left"]},{"label":["raw_vector_research"],"name":[20],"type":["chr"],"align":["left"]},{"label":["raw_environment"],"name":[21],"type":["chr"],"align":["left"]},{"label":["raw_references"],"name":[22],"type":["chr"],"align":["left"]},{"label":["raw_species_clean"],"name":[23],"type":["chr"],"align":["left"]},{"label":["raw_taxonID"],"name":[24],"type":["chr"],"align":["left"]}],"data":[{"1":"Acacia dealbata Link","2":"Angiospermae","3":"NA","4":"Y","5":"NA","6":"NA","7":"NA","8":"1847","9":"NA","10":"NA","11":"Aus","12":"Y","13":"NA","14":"NA","15":"NA","16":"Y","17":"NA","18":"Y","19":"Y","20":"NA","21":"T","22":"1-3","23":"Acacia dealbata Link","24":"rinse-pathways-checklist:taxon:bb7d7394022f5694abdc0d5c2c2cbacd"},{"1":"Acacia mearnsii De Wild.","2":"Angiospermae","3":"NA","4":"Y","5":"NA","6":"NA","7":"NA","8":"1992","9":"NA","10":"NA","11":"Aus","12":"Y","13":"NA","14":"NA","15":"Y","16":"NA","17":"NA","18":"Y","19":"NA","20":"NA","21":"T","22":"1,4","23":"Acacia mearnsii De Wild.","24":"rinse-pathways-checklist:taxon:1da1d68f7094afcd6bb78bad3779c786"},{"1":"Acacia saligna (Labill.) H. L. Wendl.","2":"Angiospermae","3":"NA","4":"Y","5":"NA","6":"NA","7":"NA","8":"1961","9":"NA","10":"NA","11":"Aus","12":"Y","13":"NA","14":"NA","15":"Y","16":"Y","17":"NA","18":"Y","19":"NA","20":"NA","21":"T","22":"1,2,4","23":"Acacia saligna (Labill.) H. L. Wendl.","24":"rinse-pathways-checklist:taxon:a1ffa9afb3f630960d0b1968785ad0de"},{"1":"Acer negundo","2":"Angiospermae","3":"Y","4":"Y","5":"Y","6":"Y","7":"1688","8":"1688","9":"1955","10":"n.d.","11":"NAm, SAm","12":"Y","13":"NA","14":"NA","15":"NA","16":"Y","17":"NA","18":"NA","19":"NA","20":"NA","21":"T","22":"1,2,5,6,7","23":"Acer negundo","24":"rinse-pathways-checklist:taxon:4e9c9f3d6de5174f9774a7cf81f921b1"},{"1":"Acroptilon repens","2":"Angiospermae","3":"Y","4":"Y","5":"Y","6":"NA","7":"1948","8":"n.d.","9":"1956","10":"NA","11":"As, Eu","12":"NA","13":"NA","14":"Y","15":"Y","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"T","22":"1,2,5","23":"Acroptilon repens","24":"rinse-pathways-checklist:taxon:d5a77fc717630fb52255180244a08406"},{"1":"Ailanthus altissima (Mill.)","2":"Angiospermae","3":"Y","4":"Y","5":"Y","6":"Y","7":"1935","8":"1786","9":"1952","10":"1800","11":"As, Aus","12":"Y","13":"NA","14":"NA","15":"Y","16":"Y","17":"NA","18":"Y","19":"NA","20":"NA","21":"T","22":"1-9","23":"Ailanthus altissima (Mill.)","24":"rinse-pathways-checklist:taxon:3a060448aea910c00b0c08ce6400eade"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="create-taxon-core" class="section level1">
<h1><span class="header-section-number">3</span> Create taxon core</h1>
<pre class="r"><code>taxon &lt;- raw_data</code></pre>
<div id="term-mapping" class="section level2">
<h2><span class="header-section-number">3.1</span> Term mapping</h2>
<p>Map the data to <a href="http://rs.gbif.org/core/dwc_taxon_2015-04-24.xml">Darwin Core Taxon</a>.</p>
<div id="language" class="section level3">
<h3><span class="header-section-number">3.1.1</span> language</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(language = &quot;en&quot;)</code></pre>
</div>
<div id="rightsholder" class="section level3">
<h3><span class="header-section-number">3.1.2</span> rightsHolder</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(rightsHolder = &quot;University of Cambridge&quot;)</code></pre>
</div>
<div id="datasetid" class="section level3">
<h3><span class="header-section-number">3.1.3</span> datasetID</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(datasetID = &quot;&quot;)</code></pre>
</div>
<div id="datasetname" class="section level3">
<h3><span class="header-section-number">3.1.4</span> datasetName</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(datasetName = &quot;RINSE - Pathways and vectors of biological invasions in Northwest Europe&quot;)</code></pre>
</div>
<div id="taxonid" class="section level3">
<h3><span class="header-section-number">3.1.5</span> taxonID</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(taxonID = raw_taxonID)</code></pre>
</div>
<div id="scientificname" class="section level3">
<h3><span class="header-section-number">3.1.6</span> scientificName</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(scientificName = raw_species_clean)</code></pre>
</div>
<div id="kingdom" class="section level3">
<h3><span class="header-section-number">3.1.7</span> kingdom</h3>
<p>Information for the higher classification is contained in <code>raw_higher_classification</code>:</p>
<pre class="r"><code>taxon %&gt;% distinct(raw_higher_classification)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_higher_classification"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"Angiospermae"},{"1":"Mollusca"},{"1":"Osteichthyes"},{"1":"Anseriformes"},{"1":"Mammalia"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>These map to different taxonomical levels (e.g. <code>Mammalia</code> = class while <code>Osteichthyes</code> = order). We interpret this information in the mapping of <code>kingdom</code>, <code>phylum</code>, <code>class</code> and <code>order</code>.</p>
<pre class="r"><code>taxon %&lt;&gt;% mutate(kingdom = case_when(
  raw_higher_classification == &quot;Angiospermae&quot; ~ &quot;Plantae&quot; ,
  TRUE ~ &quot;Animalia&quot;)) </code></pre>
</div>
<div id="phylum" class="section level3">
<h3><span class="header-section-number">3.1.8</span> phylum</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(phylum = case_when(
  raw_higher_classification == &quot;Angiospermae&quot; ~ &quot;Magnoliophyta&quot; ,
  raw_higher_classification == &quot;Mollusca&quot; ~ &quot;Mollusca&quot;,
  TRUE ~ &quot;Chordata&quot;)) </code></pre>
</div>
<div id="class" class="section level3">
<h3><span class="header-section-number">3.1.9</span> class</h3>
<p>Osteichthyes, which is a superclass, includes Actinopterygii and Sarcopterygii (<a href="https://en.wikipedia.org/wiki/Osteichthyes" class="uri">https://en.wikipedia.org/wiki/Osteichthyes</a>). All the taxa in this list are Actinopterygii which is a class.</p>
<pre class="r"><code>taxon %&lt;&gt;% mutate(class = case_when(
  raw_higher_classification == &quot;Anseriformes&quot; ~ &quot;Aves&quot;,
  raw_higher_classification == &quot;Mammalia&quot; ~ &quot;Mammalia&quot;,
  raw_higher_classification == &quot;Osteichthyes&quot; ~ &quot;Actinopterygii&quot;, 
  TRUE ~ &quot;&quot;)) </code></pre>
</div>
<div id="order" class="section level3">
<h3><span class="header-section-number">3.1.10</span> order</h3>
<pre class="r"><code>taxon %&lt;&gt;% mutate(order = case_when(
  raw_higher_classification == &quot;Anseriformes&quot; ~ &quot;Anseriformes&quot;,
  TRUE ~ &quot;&quot; )) </code></pre>
</div>
<div id="taxonrank" class="section level3">
<h3><span class="header-section-number">3.1.11</span> taxonRank</h3>
<p>The taxon rank can be provided by the <code>nameparser()</code> function of rgbif. First we create a data frame with the parsed names:</p>
<pre class="r"><code>taxon_ranks &lt;- parsenames(taxon$raw_species_clean)</code></pre>
<p>And then select rank information from <code>rankmarker</code>. The field <code>notho</code> contains valuable information for the generic hybrids, so this column is selected as well.</p>
<pre class="r"><code>taxon_ranks %&lt;&gt;% select(scientificname, rankmarker, notho) </code></pre>
<p>Merge <code>taxon_ranks</code> with <code>taxon</code> using scientific names:</p>
<pre class="r"><code>taxon %&lt;&gt;% left_join(taxon_ranks, by = c(&quot;raw_species_clean&quot; = &quot;scientificname&quot;)) </code></pre>
<p>Show unique values for <code>rankmarker</code> and <code>notho</code>:</p>
<pre class="r"><code>taxon %&gt;% 
  select(rankmarker, notho) %&gt;% 
  group_by_all() %&gt;% 
  summarise(records = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rankmarker"],"name":[1],"type":["chr"],"align":["left"]},{"label":["notho"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"f.","2":"NA","3":"1"},{"1":"infrasp.","2":"NA","3":"1"},{"1":"sp.","2":"SPECIFIC","3":"3"},{"1":"sp.","2":"NA","3":"351"},{"1":"NA","2":"NA","3":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Show <code>scientificName</code>s for which <code>rankmarker</code> = <code>NA</code>:</p>
<pre class="r"><code>taxon %&gt;% 
  select(scientificName, rankmarker) %&gt;% 
  filter(is.na(rankmarker))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["scientificName"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rankmarker"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Gyraulus chinensis Dunker, 1848","2":"NA"},{"1":"Maylandia M. K. Meyer & W. Förster, 1984","2":"NA"},{"1":"Micropogonias undulatus (Linnaeus, 1766)","2":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Maylandia M. K. Meyer &amp; W. Förster, 1984</code> is a genus, the other two records are species.</p>
<p>Map <code>taxonRank</code>:</p>
<pre class="r"><code>taxon %&lt;&gt;% mutate(taxonRank = case_when(
  !is.na(notho) ~ &quot;hybrid&quot;,
  rankmarker == &quot;sp.&quot; &amp; is.na(notho) ~ &quot;species&quot;,
  rankmarker == &quot;infrasp.&quot; ~ &quot;subspecies&quot;,
  is.na(rankmarker) &amp; scientificName != &quot;Maylandia M. K. Meyer &amp; W. Förster, 1984&quot; ~ &quot;species&quot;,
  scientificName == &quot;Maylandia M. K. Meyer &amp; W. Förster, 1984&quot; ~ &quot;genus&quot;)) </code></pre>
</div>
</div>
<div id="post-processing" class="section level2">
<h2><span class="header-section-number">3.2</span> Post-processing</h2>
<p>Remove the original columns:</p>
<pre class="r"><code>taxon %&lt;&gt;% select(-starts_with(&quot;raw_&quot;), -rankmarker, - notho)</code></pre>
<p>Sort on <code>taxonID</code>:</p>
<pre class="r"><code>taxon %&lt;&gt;% arrange(taxonID)</code></pre>
<p>Preview data:</p>
<pre class="r"><code>taxon %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["language"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rightsHolder"],"name":[2],"type":["chr"],"align":["left"]},{"label":["datasetID"],"name":[3],"type":["chr"],"align":["left"]},{"label":["datasetName"],"name":[4],"type":["chr"],"align":["left"]},{"label":["taxonID"],"name":[5],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[6],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[7],"type":["chr"],"align":["left"]},{"label":["phylum"],"name":[8],"type":["chr"],"align":["left"]},{"label":["class"],"name":[9],"type":["chr"],"align":["left"]},{"label":["order"],"name":[10],"type":["chr"],"align":["left"]},{"label":["taxonRank"],"name":[11],"type":["chr"],"align":["left"]}],"data":[{"1":"en","2":"University of Cambridge","3":"","4":"RINSE - Pathways and vectors of biological invasions in Northwest Europe","5":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","6":"Aegopinella nitens (Michaud, 1831)","7":"Animalia","8":"Mollusca","9":"","10":"","11":"species"},{"1":"en","2":"University of Cambridge","3":"","4":"RINSE - Pathways and vectors of biological invasions in Northwest Europe","5":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","6":"Galinsoga quadriradiata Ruiz & Pav.","7":"Plantae","8":"Magnoliophyta","9":"","10":"","11":"species"},{"1":"en","2":"University of Cambridge","3":"","4":"RINSE - Pathways and vectors of biological invasions in Northwest Europe","5":"rinse-pathways-checklist:taxon:04f9665a7644749f1e34d90ec21eb31f","6":"Neogobius kessleri (Günther, 1861)","7":"Animalia","8":"Chordata","9":"Actinopterygii","10":"","11":"species"},{"1":"en","2":"University of Cambridge","3":"","4":"RINSE - Pathways and vectors of biological invasions in Northwest Europe","5":"rinse-pathways-checklist:taxon:06bae93b7cb92044c0c2c0f3d9a36e9d","6":"Ferrissia fragilis (Taylor 1981)","7":"Animalia","8":"Mollusca","9":"","10":"","11":"species"},{"1":"en","2":"University of Cambridge","3":"","4":"RINSE - Pathways and vectors of biological invasions in Northwest Europe","5":"rinse-pathways-checklist:taxon:073e0f359c3485fc1346c6c04dd78a94","6":"Nassella neesiana","7":"Plantae","8":"Magnoliophyta","9":"","10":"","11":"species"},{"1":"en","2":"University of Cambridge","3":"","4":"RINSE - Pathways and vectors of biological invasions in Northwest Europe","5":"rinse-pathways-checklist:taxon:0773644ec687af9edc140218e4af2adf","6":"Oxyura maccoa (Eyton, 1838)","7":"Animalia","8":"Chordata","9":"Aves","10":"Anseriformes","11":"species"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Save to CSV:</p>
<pre class="r"><code>write.csv(taxon, file = dwc_taxon_file, na = &quot;&quot;, row.names = FALSE, fileEncoding = &quot;UTF-8&quot;)</code></pre>
</div>
</div>
<div id="create-literature-reference-extension" class="section level1">
<h1><span class="header-section-number">4</span> Create literature reference extension</h1>
<pre class="r"><code>literature_references &lt;- raw_data</code></pre>
<div id="pre-processing" class="section level2">
<h2><span class="header-section-number">4.1</span> Pre-processing</h2>
<p>Information for the literature references is contained in <code>raw_references</code>, which are (sequences of) numbers in this case. The link between these numbers and the full references is provided in the original <a href="https://github.com/trias-project/rinse-pathways-checklist/blob/master/data/raw/10530_2016_1278_MOESM2_ESM.docx">Supplementary material file</a> (page 28-30). We copy-pasted this information to a newly generated Excel file <a href="https://github.com/trias-project/rinse-pathways-checklist/blob/master/data/raw/transcribed_references.xlsx">references</a>, here saved as the dataframe <code>transcribed_references</code>:</p>
<pre class="r"><code>transcribed_references &lt;- read_excel(path = references, col_types = &quot;text&quot;)</code></pre>
<div id="full-references-on-per-row" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Full references (on per row)</h3>
<p>The literature reference extension is a dataframe in which one row contains one single reference (a short identifier and the full reference) per taxon. We generate this file in several steps:</p>
<ol style="list-style-type: decimal">
<li>Provide <strong>all</strong> reference numbers in <code>raw_references</code>, instead of using the format containing <code>-</code> for a range of numbers between a delimited minimun and maximum (e.g. <code>3-7</code> is transformed to <code>3,4,5,6,7</code>). To accomplish this, we first create the function <code>hyphen_to_sequence()</code>:</li>
</ol>
<pre class="r"><code>hyphen_to_sequence &lt;- function(input){
  seq_locs &lt;- gregexpr(&quot;\\d+-\\d+&quot;, input)
  matched &lt;- regmatches(input, seq_locs)[[1]]
  
  split_support &lt;- function(text) {
    split_seq &lt;- strsplit(text, &quot;-&quot;)[[1]]
    paste(as.character(seq(split_seq[1], split_seq[2])), collapse = &quot;,&quot;)
  }
  
  regmatches(input, seq_locs, invert = FALSE) &lt;- list(map_chr(matched, split_support))
  input
}</code></pre>
<p>Apply function:</p>
<pre class="r"><code>literature_references %&lt;&gt;% 
  rowwise() %&lt;&gt;%
  mutate(raw_references_clean = hyphen_to_sequence(raw_references)) </code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Transform <code>literature_references</code> from a wide to a long dataset, with each row containing one reference number per taxon:</li>
</ol>
<pre class="r"><code>literature_references %&lt;&gt;%
  mutate(references_sep = raw_references_clean) %&lt;&gt;% 
  ungroup() %&lt;&gt;%
  separate_rows(references_sep, sep = &quot;,&quot;)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Replace the reference numbers provided in <code>raw_references</code> with the full references provided in the dataframe <code>transcribed_references</code> using the field <code>number</code> as a link.</li>
</ol>
<pre class="r"><code>literature_references %&lt;&gt;% left_join(transcribed_references, by = c(&quot;references_sep&quot; = &quot;number&quot;))</code></pre>
<p>This dataframe constitutes the basis for further mapping of the literature reference extension:</p>
<pre class="r"><code>literature_references %&gt;%
  select(raw_species, identifier, full_reference) %&gt;%
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_species"],"name":[1],"type":["chr"],"align":["left"]},{"label":["identifier"],"name":[2],"type":["chr"],"align":["left"]},{"label":["full_reference"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Acacia dealbata Link","2":"http://www.cabi.org/isc","3":"Centre for Agricultural Bioscience International CABI (2016) Invasive Species Compendium. Wallingford, UK: CAB International. http://www.cabi.org/isc (accessed 2016)."},{"1":"Acacia dealbata Link","2":"http://www.europe-aliens.org","3":"Delivering Alien Invasive Species Inventories for Europe DAISIE (2003-2016) Alien Species Database. http://www.europe-aliens.org (accessed 2016)."},{"1":"Acacia dealbata Link","2":"http://www.eppo.int/INVASIVE_PLANTS/ias_lists.htm","3":"European and Mediterranean Plant Protection Organisation EPPO (2016) EPPO list of invasive alien plants. http://www.eppo.int/INVASIVE_PLANTS/ias_lists.htm (accessed 2016)."},{"1":"Acacia mearnsii De Wild.","2":"http://www.cabi.org/isc","3":"Centre for Agricultural Bioscience International CABI (2016) Invasive Species Compendium. Wallingford, UK: CAB International. http://www.cabi.org/isc (accessed 2016)."},{"1":"Acacia mearnsii De Wild.","2":"http://www.issg.org/database","3":"Invasive Species Specialist Group ISSG (2016) Global Invasive Species Database. http://www.issg.org/database (accessed 2016)."},{"1":"Acacia saligna (Labill.) H. L. Wendl.","2":"http://www.cabi.org/isc","3":"Centre for Agricultural Bioscience International CABI (2016) Invasive Species Compendium. Wallingford, UK: CAB International. http://www.cabi.org/isc (accessed 2016)."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="source-references-sequence-of-identifiers" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Source references (sequence of identifiers)</h3>
<p>For the mapping of the field <code>source</code> in the other extensions, we need to translate the sequence of reference numbers given for each taxon in <code>raw_references</code> into a sequence of all corresponding identifiers separated by <code>|</code>. As we need to do this several times, we generate a new dataframe <code>identifier_sequence</code> here, linking the sequence of numbers in <code>raw_references</code> with the sequence of identifiers.</p>
<p>Generate dataframe <code>identifier_sequence</code> with the required columns (add taxonID as this is necessary for spreading in the next step):</p>
<pre class="r"><code>identifier_sequence &lt;- literature_references %&gt;% select(raw_taxonID, raw_references, references_sep, identifier)</code></pre>
<p>To generate the required sequence of identifiers, we need to transform <code>identifier_sequence</code> from a dataframe containing one identifier per taxon per row, to one containing a sequence of identifiers per taxon per row. We do this by using the <code>spread()</code> function first, generating 33 identifier columns (corresponding to the 33 identifiers):</p>
<pre class="r"><code>identifier_sequence %&lt;&gt;% mutate(references_sep = as.numeric(references_sep)) %&lt;&gt;% 
  spread(references_sep, identifier) %&lt;&gt;%
  select(-`&lt;NA&gt;`)</code></pre>
<p>In the following step, we unite these 33 columns into one field <code>id_sequence</code>, using <code>|</code> as a separator. To unite the identifier columns (<code>1-33</code>) in a single step, we first rename the column names by adding the prefix <code>ref_</code>:</p>
<pre class="r"><code>old_names &lt;- c(&quot;raw_taxonID&quot;, &quot;raw_references&quot;, c(1:33))
new_names &lt;- c(&quot;raw_taxonID&quot;, &quot;raw_references&quot;, paste0(&quot;ref_&quot;, c(1:33)))
identifier_sequence %&lt;&gt;% rename_at(vars(old_names), ~ new_names)</code></pre>
<p>Generate <code>id_sequence</code>:</p>
<pre class="r"><code>identifier_sequence %&lt;&gt;% unite(&quot;id_sequence&quot;, c(paste0(&quot;ref_&quot;, c(1:33))), sep = &quot; | &quot;)</code></pre>
<p>Preview:</p>
<pre class="r"><code>identifier_sequence %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["raw_references"],"name":[2],"type":["chr"],"align":["left"]},{"label":["id_sequence"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"2,10","3":"NA | http://www.europe-aliens.org | NA | NA | NA | NA | NA | NA | NA | http://www.nederlandsesoorten.nl | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"1,2,5,7","3":"http://www.cabi.org/isc | http://www.europe-aliens.org | NA | NA | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | NA | http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA"},{"1":"rinse-pathways-checklist:taxon:04f9665a7644749f1e34d90ec21eb31f","2":"8,10,33","3":"NA | NA | NA | NA | NA | NA | NA | http://www.nobanis.org | NA | http://www.nederlandsesoorten.nl | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | http://en.wikipedia.org/wiki/Main_Page"},{"1":"rinse-pathways-checklist:taxon:06bae93b7cb92044c0c2c0f3d9a36e9d","2":"2,5,11,16","3":"NA | http://www.europe-aliens.org | NA | NA | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | NA | NA | NA | NA | NA | https://doi.org/10.1111/j.1523-1739.2009.01249.x | NA | NA | NA | NA | www.animalbase.uni-goettingen.de | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA"},{"1":"rinse-pathways-checklist:taxon:073e0f359c3485fc1346c6c04dd78a94","2":"1,4,5,7","3":"http://www.cabi.org/isc | NA | NA | http://www.issg.org/database | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | NA | http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA"},{"1":"rinse-pathways-checklist:taxon:0773644ec687af9edc140218e4af2adf","2":"5,32","3":"NA | NA | NA | NA | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | NA | http://www.unep-aewa.org/sites/default/files/document/tc8_25_review_non_native_species_0.pdf | NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Remove <code>NA</code>’s from the generated sequences:</p>
<pre class="r"><code>identifier_sequence %&lt;&gt;% mutate(id_sequence = str_replace_all(id_sequence, &quot;(([NA]{2}\\s[|]) | [|]\\s([NA]{2}))&quot;, &quot;&quot;))</code></pre>
<p>Remove <code>raw_taxonID</code>:</p>
<pre class="r"><code>identifier_sequence %&lt;&gt;% select(-raw_taxonID) </code></pre>
<p>Remove duplicate rows (some taxa have the same reference sequence):</p>
<pre class="r"><code>identifier_sequence %&lt;&gt;% distinct(raw_references, .keep_all = TRUE)</code></pre>
<p>We will use this dataframe to link the sequence of references numbers (<code>raw_references</code>) with the sequence of identifiers (<code>id_sequence</code>) in the mapping of the following extensions.</p>
</div>
</div>
<div id="term-mapping-1" class="section level2">
<h2><span class="header-section-number">4.2</span> Term mapping</h2>
<p>Map the data to <a href="http://rs.gbif.org/extension/gbif/1.0/references.xml">Literature References</a>.</p>
<div id="taxonid-1" class="section level3">
<h3><span class="header-section-number">4.2.1</span> taxonID</h3>
<pre class="r"><code>literature_references %&lt;&gt;% mutate(taxonID = raw_taxonID)</code></pre>
</div>
<div id="identifier" class="section level3">
<h3><span class="header-section-number">4.2.2</span> identifier</h3>
<pre class="r"><code>literature_references %&lt;&gt;% select(-identifier, everything()) </code></pre>
</div>
<div id="bibliographiccitation" class="section level3">
<h3><span class="header-section-number">4.2.3</span> bibliographicCitation</h3>
<pre class="r"><code>literature_references %&lt;&gt;% mutate(bibliographicCitation = full_reference) </code></pre>
</div>
</div>
<div id="post-processing-1" class="section level2">
<h2><span class="header-section-number">4.3</span> Post-processing</h2>
<p>Remove the original columns:</p>
<pre class="r"><code>literature_references %&lt;&gt;% select(-starts_with(&quot;raw_&quot;), -references_sep, -full_reference)</code></pre>
<p>Sort on <code>taxonID</code>:</p>
<pre class="r"><code>literature_references %&lt;&gt;% arrange(taxonID) </code></pre>
<p>Preview data:</p>
<pre class="r"><code>literature_references %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["identifier"],"name":[2],"type":["chr"],"align":["left"]},{"label":["bibliographicCitation"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"http://www.europe-aliens.org","3":"Delivering Alien Invasive Species Inventories for Europe DAISIE (2003-2016) Alien Species Database. http://www.europe-aliens.org (accessed 2016)."},{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"http://www.nederlandsesoorten.nl","3":"Naturalis (2005-2016) Nederlands Soortenregister, version 2.0. http://www.nederlandsesoorten.nl (accessed 2016)."},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"http://www.cabi.org/isc","3":"Centre for Agricultural Bioscience International CABI (2016) Invasive Species Compendium. Wallingford, UK: CAB International. http://www.cabi.org/isc (accessed 2016)."},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"http://www.europe-aliens.org","3":"Delivering Alien Invasive Species Inventories for Europe DAISIE (2003-2016) Alien Species Database. http://www.europe-aliens.org (accessed 2016)."},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm","3":"GB Non-native Species Secretariat (2016) GB Non-native Species Information Portal. https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm (accessed 2016)."},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf","3":"Verloove, F. (2006) Catalogue of neophytes in Belgium (1800-2005). Scripta Botanica Belgica, 39, 1-89."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Save to CSV:</p>
<pre class="r"><code>write.csv(literature_references, file = dwc_literature_references_file, na = &quot;&quot;, row.names = FALSE, fileEncoding = &quot;UTF-8&quot;)</code></pre>
</div>
</div>
<div id="create-distribution-extension" class="section level1">
<h1><span class="header-section-number">5</span> Create distribution extension</h1>
<pre class="r"><code>distribution &lt;- raw_data</code></pre>
<div id="pre-processing-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Pre-processing</h2>
<p>Information for the distributions and associated dates of first observation is contained in eight columns in total:</p>
<ul>
<li>4 columns for the distribution information (Great Britain, France, Belgium and the Netherlands in resp. <code>raw_established_gb</code>, <code>raw_established_france</code>, <code>raw_established_belgium</code> and <code>raw_established_netherlands</code>)</li>
<li>4 columns for the first record of the taxon in these countries (resp. <code>raw_first_record_gb</code>, <code>raw_first_record_france</code>, <code>raw_first_record_belgium</code> and <code>raw_first_record_netherlands</code>).</li>
</ul>
<p>When a taxon is present in a country, this is indicated by a <code>Y</code> and a date of first record is provided.</p>
<p>We need to reduce the information for eight to two columns: one column containing country presence information (<code>country column</code>, which is the basis for <code>locality</code>, <code>locationID</code> and <code>countryCode</code>) and column containing the date of first observance (<code>date</code> column, which is the basis for <code>eventDate</code>). We do this in three steps:</p>
<ol style="list-style-type: decimal">
<li>Paste date and establishment information for each country into one column (from 8 to 4 columns):</li>
</ol>
<pre class="r"><code>distribution %&lt;&gt;% mutate(record_gb = paste(raw_established_gb, raw_first_record_gb, sep = &quot;,&quot;))  %&lt;&gt;% 
  mutate(record_fr = paste(raw_established_france, raw_first_record_france, sep = &quot;,&quot;)) %&lt;&gt;% 
  mutate(record_be = paste(raw_established_belgium, raw_first_record_belgium, sep = &quot;,&quot;)) %&lt;&gt;%
  mutate(record_nl = paste(raw_established_netherlands, raw_first_record_netherlands, sep = &quot;,&quot;)) </code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Generate <code>country</code> and <code>date</code> by gathering the new columns (from 4 to 2 columns):</li>
</ol>
<pre class="r"><code>distribution %&lt;&gt;% gather(&quot;country&quot;, &quot;date&quot;, record_gb, record_fr, record_be, record_nl) </code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Clean <code>date</code> by removing records with <code>NA,NA</code> and removing <code>Y</code>:</li>
</ol>
<pre class="r"><code>distribution %&lt;&gt;% filter(date != &quot;NA,NA&quot;) %&lt;&gt;% mutate(date = str_replace_all(date, &quot;Y,&quot;, &quot;&quot;)) </code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Rename <code>country</code>:</li>
</ol>
<pre class="r"><code>distribution %&lt;&gt;% mutate(country = recode(country,
  &quot;record_gb&quot; = &quot;Great Britain&quot;,
  &quot;record_fr&quot; = &quot;France&quot;,
  &quot;record_be&quot; = &quot;Belgium&quot;,
  &quot;record_nl&quot; = &quot;The Netherlands&quot;)
)</code></pre>
<p>Preview:</p>
<pre class="r"><code>distribution %&gt;%
  select(raw_species, country, date) %&gt;%
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_species"],"name":[1],"type":["chr"],"align":["left"]},{"label":["country"],"name":[2],"type":["chr"],"align":["left"]},{"label":["date"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Acer negundo","2":"Great Britain","3":"1688"},{"1":"Acroptilon repens","2":"Great Britain","3":"1948"},{"1":"Ailanthus altissima (Mill.)","2":"Great Britain","3":"1935"},{"1":"Akebia quinata (Houtt.) Decne.","2":"Great Britain","3":"n.d."},{"1":"Ambrosia artemisiifolia Linnaeus","2":"Great Britain","3":"1836"},{"1":"Amelanchier lamarckii F. G. Schroed.","2":"Great Britain","3":"1887"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="term-mapping-2" class="section level2">
<h2><span class="header-section-number">5.2</span> Term mapping</h2>
<p>Map the data to <a href="http://rs.gbif.org/extension/gbif/1.0/distribution.xml">Species Distribution</a>.</p>
<div id="taxonid-2" class="section level3">
<h3><span class="header-section-number">5.2.1</span> taxonID</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(taxonID = raw_taxonID)</code></pre>
</div>
<div id="locationid" class="section level3">
<h3><span class="header-section-number">5.2.2</span> locationID</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(locationID = case_when(
   country == &quot;Great Britain&quot; ~ &quot; WGSRPD:GRB&quot;,
   country == &quot;France&quot; ~ &quot;ISO_3166-2:FR&quot;,
   country == &quot;Belgium&quot; ~ &quot;ISO_3166-2:BE&quot;,
   country == &quot;The Netherlands&quot; ~ &quot;ISO_3166-2:NL&quot;))</code></pre>
</div>
<div id="locality" class="section level3">
<h3><span class="header-section-number">5.2.3</span> locality</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(locality = country)</code></pre>
</div>
<div id="countrycode" class="section level3">
<h3><span class="header-section-number">5.2.4</span> countryCode</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(countryCode = case_when(
   country == &quot;Great Britain&quot; ~ &quot;GB&quot;,
   country == &quot;France&quot; ~ &quot;FR&quot;,
   country == &quot;Belgium&quot; ~ &quot;BE&quot;,
   country == &quot;The Netherlands&quot; ~ &quot;NL&quot;))</code></pre>
</div>
<div id="occurrencestatus" class="section level3">
<h3><span class="header-section-number">5.2.5</span> occurrenceStatus</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(occurrenceStatus = &quot;present&quot;) </code></pre>
</div>
<div id="establishmentmeans" class="section level3">
<h3><span class="header-section-number">5.2.6</span> establishmentMeans</h3>
<pre class="r"><code>distribution %&lt;&gt;% mutate(establishmentMeans = &quot;introduced&quot;) </code></pre>
</div>
<div id="eventdate" class="section level3">
<h3><span class="header-section-number">5.2.7</span> eventDate</h3>
<p>Inspect dates:</p>
<pre class="r"><code>distribution %&gt;% distinct(date) %&gt;% arrange(date)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"n.d."},{"1":"1600"},{"1":"1607"},{"1":"1613"},{"1":"1617"},{"1":"1645"},{"1":"1648"},{"1":"1665"},{"1":"1676"},{"1":"1683"},{"1":"1688"},{"1":"1694"},{"1":"1700"},{"1":"1720"},{"1":"1730"},{"1":"1738"},{"1":"1745"},{"1":"1750"},{"1":"17634"},{"1":"1765"},{"1":"1776"},{"1":"1786"},{"1":"1791"},{"1":"1799"},{"1":"1800"},{"1":"1803"},{"1":"1815"},{"1":"1817"},{"1":"1818"},{"1":"1820"},{"1":"1821"},{"1":"1823"},{"1":"1824"},{"1":"1825"},{"1":"1826"},{"1":"1828"},{"1":"1830"},{"1":"1831"},{"1":"1833"},{"1":"1834"},{"1":"1835"},{"1":"1836"},{"1":"1838"},{"1":"1839"},{"1":"1840"},{"1":"1842"},{"1":"1845"},{"1":"1846"},{"1":"1847"},{"1":"1849"},{"1":"1850"},{"1":"1852"},{"1":"1853"},{"1":"1856"},{"1":"1858"},{"1":"1860"},{"1":"1861"},{"1":"1862"},{"1":"1863"},{"1":"1866"},{"1":"1869"},{"1":"1870"},{"1":"1871"},{"1":"1872"},{"1":"1873"},{"1":"1874"},{"1":"1875"},{"1":"1876"},{"1":"1877"},{"1":"1878"},{"1":"1879"},{"1":"1880"},{"1":"1881"},{"1":"1882"},{"1":"1883"},{"1":"1884"},{"1":"1885"},{"1":"1886"},{"1":"1887"},{"1":"1888"},{"1":"1889"},{"1":"1890"},{"1":"1891"},{"1":"1892"},{"1":"1893"},{"1":"1894"},{"1":"1895"},{"1":"1896"},{"1":"1897"},{"1":"1898"},{"1":"1899"},{"1":"1900"},{"1":"1901"},{"1":"1902"},{"1":"1903"},{"1":"1904"},{"1":"1906"},{"1":"1907"},{"1":"1908"},{"1":"1909"},{"1":"1910"},{"1":"1911"},{"1":"1913"},{"1":"1915"},{"1":"1916"},{"1":"1917"},{"1":"1918"},{"1":"1919"},{"1":"1920"},{"1":"19204"},{"1":"1922"},{"1":"1924"},{"1":"1925"},{"1":"1926"},{"1":"1927"},{"1":"1928"},{"1":"1929"},{"1":"1930"},{"1":"1931"},{"1":"1933"},{"1":"1934"},{"1":"1935"},{"1":"1936"},{"1":"1937"},{"1":"1938"},{"1":"1939"},{"1":"1940"},{"1":"1941"},{"1":"1942"},{"1":"1943"},{"1":"1944"},{"1":"1945"},{"1":"1946"},{"1":"1948"},{"1":"1949"},{"1":"1950"},{"1":"1952"},{"1":"1953"},{"1":"1954"},{"1":"1955"},{"1":"1956"},{"1":"1957"},{"1":"1958"},{"1":"1959"},{"1":"1960"},{"1":"1961"},{"1":"1962"},{"1":"1963"},{"1":"1964"},{"1":"1965"},{"1":"1966"},{"1":"1967"},{"1":"1968"},{"1":"1969"},{"1":"1970"},{"1":"1971"},{"1":"1972"},{"1":"1973"},{"1":"1974"},{"1":"1975"},{"1":"1976"},{"1":"1977"},{"1":"1978"},{"1":"1979"},{"1":"1980"},{"1":"1981"},{"1":"1982"},{"1":"1983"},{"1":"1984"},{"1":"1985"},{"1":"1985,"},{"1":"1986"},{"1":"1987"},{"1":"1988"},{"1":"1989"},{"1":"199"},{"1":"1990"},{"1":"1991"},{"1":"1992"},{"1":"1993"},{"1":"1994"},{"1":"1995"},{"1":"1996"},{"1":"1997"},{"1":"1998"},{"1":"1999"},{"1":"2000"},{"1":"2001"},{"1":"2001"},{"1":"2002"},{"1":"2003"},{"1":"2004"},{"1":"2004,"},{"1":"2005"},{"1":"2006"},{"1":"2007"},{"1":"2008"},{"1":"2009"},{"1":"2010"},{"1":"2011"},{"1":"2012"},{"1":"n..d"},{"1":"n.d."},{"1":"__NA__"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Check which dates deviate from the required ISO 8601 format (here <code>YYYY</code>)</p>
<pre class="r"><code>unique(distribution[which(str_detect(distribution $ date,&quot;^[0-9]{4}$&quot;) == FALSE), &quot;date&quot;])</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"n.d."},{"1":"17634"},{"1":"2004,"},{"1":"n..d"},{"1":"199"},{"1":"1985,"},{"1":"__NA__"},{"1":"n.d."},{"1":"19204"},{"1":"2001"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Clean those dates:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(date = str_trim(date)) # remove whitespaces

distribution %&lt;&gt;% mutate(date = recode(date,    # recode deviating formats
   &quot;n.d.&quot;  = &quot;&quot;,
   &quot;17634&quot; = &quot;1763&quot;,
   &quot;2004,&quot; = &quot;2004&quot;,
   &quot;n..d&quot;  = &quot;&quot;,
   &quot;199&quot;   = &quot;1990&quot;,
   &quot;1985,&quot; = &quot;1985&quot;,
   &quot;NA&quot;    = &quot;&quot;,
   &quot;19204&quot; = &quot;1904&quot;)) </code></pre>
<p>After this cleaning step, there should be no deviations from the ISO 8601 format:</p>
<pre class="r"><code>unique(distribution[which(str_detect(distribution $ date,&quot;^[0-9]{4}$&quot;) == FALSE), &quot;date&quot;])</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We want to express <code>eventDate</code> as the range between the date of first and last record. In this case, we do not have information about the last record. We will consider the publication year of Zieritz et al. (2017) as the date when the presence of the species was last verified:</p>
<pre class="r"><code>distribution %&lt;&gt;% mutate(eventDate = case_when(
  date == &quot;&quot; ~ &quot;&quot;,
  date != &quot;&quot; ~ paste(date, &quot;2017&quot;, sep = &quot;/&quot;))) </code></pre>
</div>
<div id="source" class="section level3">
<h3><span class="header-section-number">5.2.8</span> source</h3>
<p>Information about the source is provided in <code>raw_references</code>. We replace the sequence of reference numbers by the sequence of identifiers (not full references), provided in the dataframe <code>identifier_sequence</code> generated earlier.</p>
<pre class="r"><code>distribution %&lt;&gt;% left_join(identifier_sequence, by = (&quot;raw_references&quot;))</code></pre>
<p>Rename <code>id_sequence</code>:</p>
<pre class="r"><code>distribution %&lt;&gt;%  rename(&quot;source&quot; = &quot;id_sequence&quot;)</code></pre>
</div>
</div>
<div id="post-processing-2" class="section level2">
<h2><span class="header-section-number">5.3</span> Post-processing</h2>
<p>Remove the original columns:</p>
<pre class="r"><code>distribution %&lt;&gt;% select(-starts_with(&quot;raw_&quot;), -country, -date)</code></pre>
<p>Sort on <code>taxonID</code>:</p>
<pre class="r"><code>distribution %&lt;&gt;% arrange(taxonID) </code></pre>
<p>Preview data:</p>
<pre class="r"><code>distribution %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["locationID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["locality"],"name":[3],"type":["chr"],"align":["left"]},{"label":["countryCode"],"name":[4],"type":["chr"],"align":["left"]},{"label":["occurrenceStatus"],"name":[5],"type":["chr"],"align":["left"]},{"label":["establishmentMeans"],"name":[6],"type":["chr"],"align":["left"]},{"label":["eventDate"],"name":[7],"type":["chr"],"align":["left"]},{"label":["source"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"ISO_3166-2:BE","3":"Belgium","4":"BE","5":"present","6":"introduced","7":"","8":"http://www.europe-aliens.org | http://www.nederlandsesoorten.nl"},{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"ISO_3166-2:NL","3":"The Netherlands","4":"NL","5":"present","6":"introduced","7":"","8":"http://www.europe-aliens.org | http://www.nederlandsesoorten.nl"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"WGSRPD:GRB","3":"Great Britain","4":"GB","5":"present","6":"introduced","7":"1909/2017","8":"http://www.cabi.org/isc | http://www.europe-aliens.org | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"ISO_3166-2:FR","3":"France","4":"FR","5":"present","6":"introduced","7":"1973/2017","8":"http://www.cabi.org/isc | http://www.europe-aliens.org | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"ISO_3166-2:BE","3":"Belgium","4":"BE","5":"present","6":"introduced","7":"1900/2017","8":"http://www.cabi.org/isc | http://www.europe-aliens.org | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"ISO_3166-2:NL","3":"The Netherlands","4":"NL","5":"present","6":"introduced","7":"1920/2017","8":"http://www.cabi.org/isc | http://www.europe-aliens.org | https://secure.fera.defra.gov.uk/nonnativespecies/home/index.cfm | http://alienplantsbelgium.be/sites/alienplantsbelgium.be/files/tabel_2.pdf"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Save to CSV:</p>
<pre class="r"><code>write.csv(distribution, file = dwc_distribution_file, na = &quot;&quot;, row.names = FALSE, fileEncoding = &quot;UTF-8&quot;)</code></pre>
</div>
</div>
<div id="create-species-profile-extension" class="section level1">
<h1><span class="header-section-number">6</span> Create species profile extension</h1>
<p>In this extension we express broad habitat characteristics (e.g. <code>isTerrestrial</code>) of the species.</p>
<pre class="r"><code>species_profile &lt;- raw_data</code></pre>
<p>Habitat information can be found in <code>raw_environment</code>, which describes whether a species is found in freshwater, terrestrial, marine or a combination of these habitats.</p>
<p>Show unique values:</p>
<pre class="r"><code>species_profile %&gt;%
  select(raw_environment) %&gt;%
  group_by_all() %&gt;% 
  summarize(records = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_environment"],"name":[1],"type":["chr"],"align":["left"]},{"label":["records"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"F","2":"90"},{"1":"F,T","2":"1"},{"1":"F+T","2":"90"},{"1":"M","2":"50"},{"1":"M+F","2":"22"},{"1":"T","2":"103"},{"1":"T+M","2":"1"},{"1":"NA","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Only two taxa have no information on the environment:</p>
<ul>
<li><code>Salvelinus fontinalis</code> (brook trout): a fish found in both freshwater and marine habitats</li>
<li><code>Rattus norvegicus</code>(brown rat): a terrestrial mammal</li>
</ul>
<p>We will add this information in the mapping. Environment information is mapped to <code>isFreshwater</code>, <code>isTerrestrial</code>, <code>isMarine</code> or a combination of these terms in the species profile extension.</p>
<div id="term-mapping-3" class="section level2">
<h2><span class="header-section-number">6.1</span> Term mapping</h2>
<p>Map the data to <a href="http://rs.gbif.org/extension/gbif/1.0/speciesprofile.xml">Species Profile</a>.</p>
<div id="taxonid-3" class="section level3">
<h3><span class="header-section-number">6.1.1</span> taxonID</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(taxonID = raw_taxonID)</code></pre>
</div>
<div id="ismarine" class="section level3">
<h3><span class="header-section-number">6.1.2</span> isMarine</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(isMarine = case_when(
  raw_environment == &quot;M&quot; |
  raw_environment == &quot;M+F&quot; |
  raw_environment == &quot;T+M&quot; | 
  raw_species == &quot;Salvelinus fontinalis (Mitchill, 1814)&quot; ~ &quot;TRUE&quot;,
  TRUE ~ &quot;FALSE&quot;
))</code></pre>
</div>
<div id="isfreshwater" class="section level3">
<h3><span class="header-section-number">6.1.3</span> isFreshwater</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(isFreshwater = case_when(
  raw_environment == &quot;F&quot; |
  raw_environment == &quot;F,T&quot; |
  raw_environment == &quot;F+T&quot; |
  raw_environment == &quot;M+F&quot; |
  raw_species == &quot;Salvelinus fontinalis (Mitchill, 1814)&quot; ~ &quot;TRUE&quot;,
  TRUE ~ &quot;FALSE&quot;))</code></pre>
</div>
<div id="isterrestrial" class="section level3">
<h3><span class="header-section-number">6.1.4</span> isTerrestrial</h3>
<pre class="r"><code>species_profile %&lt;&gt;% mutate(isTerrestrial = case_when(
  raw_environment == &quot;F,T&quot; |
  raw_environment == &quot;F+T&quot; |
  raw_environment == &quot;T&quot; |
  raw_environment == &quot;T+M&quot; |
  raw_species == &quot;Rattus norvegicus (Berkenhout 1769)&quot; ~ &quot;TRUE&quot;,
  TRUE ~&quot;FALSE&quot;))</code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>species_profile %&gt;%
  select(raw_environment, isMarine, isFreshwater, isTerrestrial) %&gt;%
  group_by_all() %&gt;%
  summarize(records = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_environment"],"name":[1],"type":["chr"],"align":["left"]},{"label":["isMarine"],"name":[2],"type":["chr"],"align":["left"]},{"label":["isFreshwater"],"name":[3],"type":["chr"],"align":["left"]},{"label":["isTerrestrial"],"name":[4],"type":["chr"],"align":["left"]},{"label":["records"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"F","2":"FALSE","3":"TRUE","4":"FALSE","5":"90"},{"1":"F,T","2":"FALSE","3":"TRUE","4":"TRUE","5":"1"},{"1":"F+T","2":"FALSE","3":"TRUE","4":"TRUE","5":"90"},{"1":"M","2":"TRUE","3":"FALSE","4":"FALSE","5":"50"},{"1":"M+F","2":"TRUE","3":"TRUE","4":"FALSE","5":"22"},{"1":"T","2":"FALSE","3":"FALSE","4":"TRUE","5":"103"},{"1":"T+M","2":"TRUE","3":"FALSE","4":"TRUE","5":"1"},{"1":"NA","2":"FALSE","3":"FALSE","4":"TRUE","5":"1"},{"1":"NA","2":"TRUE","3":"TRUE","4":"FALSE","5":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="post-processing-3" class="section level2">
<h2><span class="header-section-number">6.2</span> Post-processing</h2>
<p>Remove the original columns:</p>
<pre class="r"><code>species_profile %&lt;&gt;% select(-starts_with(&quot;raw_&quot;))</code></pre>
<p>Sort on <code>taxonID</code>:</p>
<pre class="r"><code>species_profile %&lt;&gt;% arrange(taxonID)</code></pre>
<p>Preview data:</p>
<pre class="r"><code>species_profile %&gt;% head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["isMarine"],"name":[2],"type":["chr"],"align":["left"]},{"label":["isFreshwater"],"name":[3],"type":["chr"],"align":["left"]},{"label":["isTerrestrial"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"rinse-pathways-checklist:taxon:04f9665a7644749f1e34d90ec21eb31f","2":"TRUE","3":"TRUE","4":"FALSE"},{"1":"rinse-pathways-checklist:taxon:06bae93b7cb92044c0c2c0f3d9a36e9d","2":"FALSE","3":"TRUE","4":"FALSE"},{"1":"rinse-pathways-checklist:taxon:073e0f359c3485fc1346c6c04dd78a94","2":"FALSE","3":"FALSE","4":"TRUE"},{"1":"rinse-pathways-checklist:taxon:0773644ec687af9edc140218e4af2adf","2":"FALSE","3":"TRUE","4":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Save to CSV:</p>
<pre class="r"><code>write.csv(species_profile, file = dwc_profile_file, na = &quot;&quot;, row.names = FALSE, fileEncoding = &quot;UTF-8&quot;)</code></pre>
</div>
</div>
<div id="create-description-extension" class="section level1">
<h1><span class="header-section-number">7</span> Create description extension</h1>
<p>In the description extension we want to include several important characteristics (hereafter refered to as descriptors) about the species:</p>
<ul>
<li>Native range</li>
<li>Pathway of introduction</li>
</ul>
<p>A single taxon can have multiple descriptions of the same type (e.g. multiple native ranges), expressed as multiple rows in the description extension. For each descriptor, we create a separate dataframe to process the specific information. We always specify <em>which descriptor</em> we map (<code>type</code> column) and its <em>specific content</em> (<code>description</code> column). After the mapping of these Darwin Core terms <code>type</code> and <code>value</code>, we merge the dataframes to generate one single description extension. We then continue the mapping process by adding the other Darwin Core terms (which content is independent of the type of descriptor, such as <code>language</code>).</p>
<div id="native-range" class="section level2">
<h2><span class="header-section-number">7.1</span> Native range</h2>
<p>Native range information (e.g. <code>Australia</code>) can be found in <code>raw_origin</code>.</p>
<p>Create separate dataframe:</p>
<pre class="r"><code>native_range &lt;- raw_data</code></pre>
<p>Show unique values:</p>
<pre class="r"><code>native_range %&gt;% 
  distinct(raw_origin) %&gt;% 
  arrange(raw_origin)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_origin"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"Af"},{"1":"Af, As"},{"1":"Af, As, Aus, Eu"},{"1":"Af, As, Eu"},{"1":"Af, As, NAm"},{"1":"Af, As, NAm, SAm"},{"1":"Af, As, SAm"},{"1":"Af, Aus, SAm"},{"1":"Af, Eu"},{"1":"Af, SAm"},{"1":"Ar, Eu"},{"1":"Ar, Eu, NAm"},{"1":"As"},{"1":"As , Eu"},{"1":"As, Aus"},{"1":"As, Eu"},{"1":"As, Eu, NAm"},{"1":"As, NAm"},{"1":"As, NAm, SAm"},{"1":"Au"},{"1":"Aus"},{"1":"Aus, NAm, SAm"},{"1":"Eu"},{"1":"Eu , As , Af"},{"1":"Eu, NAm"},{"1":"Eu, NAm, SAm"},{"1":"n.d."},{"1":"na"},{"1":"NAm"},{"1":"NAm, SAm"},{"1":"SAm"},{"1":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>raw_origin</code> contains multiple values (currently not more than 4), so we separate it in 4 columns:</p>
<pre class="r"><code>native_range %&lt;&gt;% separate(raw_origin, into = paste(&quot;origin&quot;, c(1:4), sep = &quot;_&quot;))</code></pre>
<p>Gather in a <code>key</code> and <code>value</code> column:</p>
<pre class="r"><code>native_range %&lt;&gt;% gather(&quot;key&quot;, &quot;value&quot;, paste(&quot;origin&quot;, c(1:4), sep = &quot;_&quot;), na.rm = TRUE) </code></pre>
<p>Inspect values:</p>
<pre class="r"><code>native_range %&gt;% 
  distinct(value) %&gt;% 
  arrange(value)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["value"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":""},{"1":"Af"},{"1":"Ar"},{"1":"As"},{"1":"Au"},{"1":"Aus"},{"1":"d"},{"1":"Eu"},{"1":"n"},{"1":"na"},{"1":"NAm"},{"1":"SAm"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Map values:</p>
<pre class="r"><code>native_range %&lt;&gt;% mutate(mapped_value = recode(value,
  &quot;Af&quot;  = &quot;Africa (WGSRPD:2)&quot;,
  &quot;Ar&quot;  = &quot;Arctic&quot;,
  &quot;As&quot;  = &quot;Asia&quot;,
  &quot;Au&quot;  = &quot;Australia (WGSRPD:50)&quot;,
  &quot;Aus&quot; = &quot;Australia (WGSRPD:50)&quot;,
  &quot;d&quot;   = &quot;&quot;,
  &quot;Eu&quot;  = &quot;Europe (WGSRPD:1)&quot;,
  &quot;n&quot;   = &quot;&quot;,
  &quot;na&quot;  = &quot;&quot;,
  &quot;NAm&quot; = &quot;Northern America (WGSRPD:7)&quot;,
  &quot;SAm&quot; = &quot;Southern America (WGSRPD:8)&quot;
)) </code></pre>
<p>Show mapped values:</p>
<pre class="r"><code>native_range %&gt;%
  select(value, mapped_value) %&gt;%
  group_by(value, mapped_value) %&gt;%
  summarize(records = n()) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["value"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mapped_value"],"name":[2],"type":["chr"],"align":["left"]},{"label":["records"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"","2":"","3":"1"},{"1":"Af","2":"Africa (WGSRPD:2)","3":"38"},{"1":"Ar","2":"Arctic","3":"2"},{"1":"As","2":"Asia","3":"119"},{"1":"Au","2":"Australia (WGSRPD:50)","3":"1"},{"1":"Aus","2":"Australia (WGSRPD:50)","3":"22"},{"1":"d","2":"","3":"1"},{"1":"Eu","2":"Europe (WGSRPD:1)","3":"111"},{"1":"n","2":"","3":"1"},{"1":"na","2":"","3":"2"},{"1":"NAm","2":"Northern America (WGSRPD:7)","3":"122"},{"1":"SAm","2":"Southern America (WGSRPD:8)","3":"59"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Keep only non-empty descriptions:</p>
<pre class="r"><code>native_range %&lt;&gt;% filter(!is.na(mapped_value) &amp; mapped_value != &quot;&quot;)</code></pre>
<p>Drop the <code>key</code> and <code>value</code> columns and rename <code>mapped_value</code> as <code>description</code>:</p>
<pre class="r"><code>native_range %&lt;&gt;%
  select(-key, -value) %&gt;%
  rename(description = mapped_value)</code></pre>
<p>Create a <code>type</code> field to indicate the type of description:</p>
<pre class="r"><code>native_range %&lt;&gt;% mutate(type = &quot;native range&quot;)</code></pre>
</div>
<div id="pathway-of-introduction" class="section level2">
<h2><span class="header-section-number">7.2</span> Pathway of introduction</h2>
<p>Pathway information in this dataset is a combination of the columns starting with <code>raw_pathway_</code> (4 columns: <code>raw_pathway_accidental</code>, <code>raw_pathway_disperal</code>, <code>raw_pathway_import_escape</code> and <code>raw_pathway_import_release</code>) and <code>raw_vector_</code> (5 columns: <code>raw_vector_biocontrol</code>, <code>raw_vector_leisure</code>, <code>raw_vector_industry</code>, <code>raw_vector_ornamental</code> and <code>raw_vector_research</code>):</p>
<pre class="r"><code>raw_data %&gt;% select(starts_with(&quot;raw_vector&quot;), starts_with(&quot;raw_pathway&quot;)) %&gt;% 
  group_by_all() %&gt;% 
  summarize(records = n()) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_vector_ornamental"],"name":[1],"type":["chr"],"align":["left"]},{"label":["raw_vector_leisure"],"name":[2],"type":["chr"],"align":["left"]},{"label":["raw_vector_industry"],"name":[3],"type":["chr"],"align":["left"]},{"label":["raw_vector_biocontrol"],"name":[4],"type":["chr"],"align":["left"]},{"label":["raw_vector_research"],"name":[5],"type":["chr"],"align":["left"]},{"label":["raw_pathway_import_release"],"name":[6],"type":["chr"],"align":["left"]},{"label":["raw_pathway_import_escape"],"name":[7],"type":["chr"],"align":["left"]},{"label":["raw_pathway_accidental"],"name":[8],"type":["chr"],"align":["left"]},{"label":["raw_pathway_dispersal"],"name":[9],"type":["chr"],"align":["left"]},{"label":["records"],"name":[10],"type":["int"],"align":["right"]}],"data":[{"1":"Y","2":"Y","3":"Y","4":"Y","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"Y","3":"Y","4":"NA","5":"Y","6":"Y","7":"Y","8":"Y","9":"NA","10":"1"},{"1":"Y","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"3"},{"1":"Y","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"1"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"Y","6":"Y","7":"Y","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"Y","6":"Y","7":"Y","8":"NA","9":"NA","10":"4"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"Y","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"Y","6":"Y","7":"NA","8":"NA","9":"NA","10":"1"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"Y","10":"1"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"3"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"2"},{"1":"Y","2":"Y","3":"NA","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"5"},{"1":"Y","2":"NA","3":"Y","4":"Y","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"NA","3":"Y","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"Y","2":"NA","3":"Y","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"1"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"NA","10":"1"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"4"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"4"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"Y","9":"Y","10":"1"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"7"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"3"},{"1":"Y","2":"NA","3":"Y","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"Y","2":"NA","3":"NA","4":"Y","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"2"},{"1":"Y","2":"NA","3":"NA","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"2"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"Y","6":"Y","7":"Y","8":"NA","9":"Y","10":"2"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"Y","6":"Y","7":"Y","8":"NA","9":"NA","10":"11"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"5"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"18"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"Y","9":"Y","10":"1"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"12"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"12"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"Y","8":"Y","9":"Y","10":"1"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"Y","8":"Y","9":"NA","10":"2"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"48"},{"1":"Y","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"9"},{"1":"NA","2":"Y","3":"Y","4":"Y","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"1"},{"1":"NA","2":"Y","3":"Y","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"Y","10":"1"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"NA","10":"1"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"3"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"3"},{"1":"NA","2":"Y","3":"Y","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"Y","3":"NA","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"NA","2":"Y","3":"NA","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"Y","3":"NA","4":"NA","5":"Y","6":"Y","7":"NA","8":"NA","9":"NA","10":"2"},{"1":"NA","2":"Y","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"NA","10":"1"},{"1":"NA","2":"Y","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"7"},{"1":"NA","2":"Y","3":"NA","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"Y","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"1"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"Y","6":"Y","7":"Y","8":"NA","9":"NA","10":"2"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"Y","6":"NA","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"Y","10":"2"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"2"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"7"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"Y","9":"Y","10":"1"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"Y","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"Y","10":"3"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"10"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"NA","7":"Y","8":"Y","9":"Y","10":"2"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"6"},{"1":"NA","2":"NA","3":"Y","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"2"},{"1":"NA","2":"NA","3":"NA","4":"Y","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"Y","6":"NA","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"Y","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"Y","10":"1"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"Y","8":"NA","9":"NA","10":"3"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"Y","9":"Y","10":"1"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"Y","7":"NA","8":"NA","9":"NA","10":"2"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"Y","8":"NA","9":"NA","10":"1"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"Y","9":"Y","10":"15"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"Y","9":"NA","10":"44"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"Y","10":"2"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"45"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This information will be mapped to the six <strong>main categories</strong> of the <a href="https://www.cbd.int/doc/meetings/sbstta/sbstta-18/official/sbstta-18-09-add1-en.pdf">CBD standard</a>. How these RINSE pathways map to the CBD standard is described in the source paper Zieritz et al. (2017) (in Methods &gt; Data analysis):</p>
<table>
<thead>
<tr class="header">
<th>RINSE pathway</th>
<th>CBD category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>accidental</td>
<td>stowaway, contaminant</td>
</tr>
<tr class="even">
<td>dispersal</td>
<td>corridor, undaided</td>
</tr>
<tr class="odd">
<td>import_release</td>
<td>release</td>
</tr>
<tr class="even">
<td>import_escape</td>
<td>escape</td>
</tr>
</tbody>
</table>
<p>For certain taxa, we will complement this pathway information with the specific vector of introduction (contained in columns starting with <code>raw_vector_</code>), using the <strong>subcategories</strong> of the CBD standard:</p>
<ul>
<li>For pathways <code>accidental</code> and <code>disperal</code>, we will <strong>never</strong> provide vector information. This is because vectors of accidentally introduced species were not analysed in the present study, due to a lack of reliable data (see Zieritz et al. 2017).</li>
<li>For pathways <code>import_escape</code> and <code>import_release</code>, we will map vector information to the CBD subcategories <strong>only</strong> when they map unambigiously to this standard (see table below and <a href="https://github.com/trias-project/rinse-pathways-checklist/issues/3">this issue</a>) <strong>and</strong> when these vectors are the only vectors of introduction for these taxon.</li>
</ul>
<table>
<thead>
<tr class="header">
<th>RINSE pathway</th>
<th>RINSE vector</th>
<th>CBD category</th>
<th>CBD subcategory</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>accidental</td>
<td>biocontrol</td>
<td>stowaway, contaminant</td>
<td>NA</td>
</tr>
<tr class="even">
<td>accidental</td>
<td>industry</td>
<td>stowaway, contaminant</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>accidental</td>
<td>leisure</td>
<td>stowaway, contaminant</td>
<td>NA</td>
</tr>
<tr class="even">
<td>accidental</td>
<td>ornamental</td>
<td>stowaway, contaminant</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>accidental</td>
<td>research</td>
<td>stowaway, contaminant</td>
<td>NA</td>
</tr>
<tr class="even">
<td>dispersal</td>
<td>biocontrol</td>
<td>corridor, unaided</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>dispersal</td>
<td>industry</td>
<td>corridor, unaided</td>
<td>NA</td>
</tr>
<tr class="even">
<td>dispersal</td>
<td>leisure</td>
<td>corridor, unaided</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>dispersal</td>
<td>ornamental</td>
<td>corridor, unaided</td>
<td>NA</td>
</tr>
<tr class="even">
<td>dispersal</td>
<td>research</td>
<td>corridor, unaided</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>import_escape</td>
<td>biocontrol</td>
<td>escape</td>
<td>NA</td>
</tr>
<tr class="even">
<td>import_escape</td>
<td>industry</td>
<td>escape</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>import_escape</td>
<td>leisure</td>
<td>escape</td>
<td>live food and bait</td>
</tr>
<tr class="even">
<td>import_escape</td>
<td>ornamental</td>
<td>escape</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>import_escape</td>
<td>research</td>
<td>escape</td>
<td>research and ex-situ breeding (in facilities)</td>
</tr>
<tr class="even">
<td>import_release</td>
<td>biocontrol</td>
<td>release</td>
<td>biological control</td>
</tr>
<tr class="odd">
<td>import_release</td>
<td>industry</td>
<td>release</td>
<td>NA</td>
</tr>
<tr class="even">
<td>import_release</td>
<td>leisure</td>
<td>release</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>import_release</td>
<td>ornamental</td>
<td>release</td>
<td>NA</td>
</tr>
<tr class="even">
<td>import_release</td>
<td>research</td>
<td>release</td>
<td>NA</td>
</tr>
</tbody>
</table>
<p>We map this information in the new column <code>description</code>, for which we use the <a href="https://github.com/trias-project/vocab/blob/master/vocabulary/pathway/pathways.tsv">TrIAS vocabulary</a>.</p>
<p>Create separate dataframe:</p>
<pre class="r"><code>pathway_desc &lt;- raw_data</code></pre>
<p>We gather pathway information in one new column <code>pathway</code>:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% gather(pathway, value, starts_with(&quot;raw_pathway_&quot;), na.rm = TRUE, convert = TRUE)</code></pre>
<p>Column “value” will only contain “Y”, so no need for this column</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% select(-value)</code></pre>
<p>Map patwhay information to the CBD main category:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% mutate(description = recode(pathway,
  &quot;raw_pathway_accidental&quot; = &quot;stowaway,contaminant&quot;,
  &quot;raw_pathway_dispersal&quot; = &quot;corridor,natural_dispersal&quot;,
  &quot;raw_pathway_import_escape&quot; = &quot;escape&quot;,
  &quot;raw_pathway_import_release&quot; = &quot;release&quot;
))</code></pre>
<p>Arrange by taxonID to see things more in context:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% arrange(raw_taxonID)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["raw_taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["description"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"stowaway,contaminant"},{"1":"rinse-pathways-checklist:taxon:06bae93b7cb92044c0c2c0f3d9a36e9d","2":"stowaway,contaminant"},{"1":"rinse-pathways-checklist:taxon:073e0f359c3485fc1346c6c04dd78a94","2":"stowaway,contaminant"},{"1":"rinse-pathways-checklist:taxon:0773644ec687af9edc140218e4af2adf","2":"escape"},{"1":"rinse-pathways-checklist:taxon:0b7deda89c2ce2b3d771dec643e4d446","2":"release"},{"1":"rinse-pathways-checklist:taxon:0b7deda89c2ce2b3d771dec643e4d446","2":"escape"},{"1":"rinse-pathways-checklist:taxon:0b7deda89c2ce2b3d771dec643e4d446","2":"corridor,natural_dispersal"},{"1":"rinse-pathways-checklist:taxon:0b8a1e5309557e6dd56fc9f4e0ed70e1","2":"stowaway,contaminant"},{"1":"rinse-pathways-checklist:taxon:0cc9b45fda909a172bd3a1448c8b77a2","2":"stowaway,contaminant"},{"1":"rinse-pathways-checklist:taxon:0cc9b45fda909a172bd3a1448c8b77a2","2":"corridor,natural_dispersal"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Map vector information to CBD subcategories for some taxa:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% mutate(description = case_when(
  description == &quot;escape&quot; &amp;
    raw_vector_research == &quot;Y&quot; &amp; 
    raw_vector_leisure == &quot;Y&quot; &amp;
    is.na(raw_vector_ornamental) &amp;
    is.na(raw_vector_biocontrol) &amp; 
    is.na(raw_vector_industry) ~ &quot;escape_research, escape_food_bait&quot;,
  description == &quot;escape&quot; &amp;
    raw_vector_research == &quot;Y&quot; &amp; 
    is.na(raw_vector_leisure ) &amp;
    is.na(raw_vector_ornamental) &amp;
    is.na(raw_vector_biocontrol) &amp; 
    is.na(raw_vector_industry) ~ &quot;escape_research&quot;,
  description == &quot;escape&quot; &amp;
    is.na(raw_vector_research) &amp; 
    raw_vector_leisure == &quot;Y&quot; &amp;
    is.na(raw_vector_ornamental) &amp;
    is.na(raw_vector_biocontrol) &amp; 
    is.na(raw_vector_industry) ~ &quot;escape_food_bait&quot;,
  description == &quot;release&quot; &amp;
    is.na(raw_vector_research) &amp; 
    is.na(raw_vector_leisure) &amp;
    is.na(raw_vector_ornamental) &amp;
    raw_vector_biocontrol == &quot;Y&quot; &amp; 
    is.na(raw_vector_industry) ~ &quot;release_biocontrol&quot;,
TRUE ~ description # Leave rest as is
))</code></pre>
<p>Separate <code>description</code> when more than two values are provided, e.g. in case of RINSE pathway = <code>accidental</code> or RINSE pathway = <code>dispersal</code>:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% separate_rows(description, sep = &quot;,&quot;)</code></pre>
<p>Remove all empty description values:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% filter(description != &quot;&quot;) </code></pre>
<p>Remove duplicate rows:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% distinct(raw_taxonID, description, .keep_all = TRUE)</code></pre>
<p>Remove <code>pathway</code>:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% select(-pathway)</code></pre>
<p>Add the prefix <code>cbd_2014_pathway:</code> to refer to this standard:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% mutate(description = paste (&quot;cbd_2014_pathway&quot;, description, sep = &quot;:&quot;))</code></pre>
<p>Create a <code>type</code> field to indicate the type of description:</p>
<pre class="r"><code>pathway_desc %&lt;&gt;% mutate(type = &quot;pathway&quot;)</code></pre>
</div>
<div id="union-descriptions" class="section level2">
<h2><span class="header-section-number">7.3</span> Union descriptions</h2>
<p>Union native range and pathway of introduction:</p>
<pre class="r"><code>description_ext &lt;- bind_rows(native_range, pathway_desc)</code></pre>
</div>
<div id="term-mapping-4" class="section level2">
<h2><span class="header-section-number">7.4</span> Term mapping</h2>
<p>Map the data to <a href="http://rs.gbif.org/extension/gbif/1.0/description.xml">Taxon Description</a>.</p>
<div id="taxonid-4" class="section level3">
<h3><span class="header-section-number">7.4.1</span> taxonID</h3>
<pre class="r"><code>description_ext %&lt;&gt;% mutate(taxonID = raw_taxonID)</code></pre>
</div>
<div id="description" class="section level3">
<h3><span class="header-section-number">7.4.2</span> description</h3>
<pre class="r"><code>description_ext %&lt;&gt;% mutate(description = description)</code></pre>
</div>
<div id="type" class="section level3">
<h3><span class="header-section-number">7.4.3</span> type</h3>
<pre class="r"><code>description_ext %&lt;&gt;% mutate(type = type)</code></pre>
</div>
<div id="source-1" class="section level3">
<h3><span class="header-section-number">7.4.4</span> source</h3>
<p>Information about the source is provided in <code>raw_references</code>. We replace the sequence of reference numbers by the sequence of identifiers (not full references), provided in the dataframe <code>identifier_sequence</code> generated earlier.</p>
<pre class="r"><code>description_ext %&lt;&gt;% left_join(identifier_sequence, by = (&quot;raw_references&quot;))</code></pre>
<p>Rename <code>id_sequence</code>:</p>
<pre class="r"><code>description_ext %&lt;&gt;%  rename(&quot;source&quot; = &quot;id_sequence&quot;)</code></pre>
</div>
<div id="language-1" class="section level3">
<h3><span class="header-section-number">7.4.5</span> language</h3>
<pre class="r"><code>description_ext %&lt;&gt;% mutate(language = &quot;en&quot;)</code></pre>
</div>
</div>
<div id="post-processing-4" class="section level2">
<h2><span class="header-section-number">7.5</span> Post-processing</h2>
<p>Remove the original columns:</p>
<pre class="r"><code>description_ext %&lt;&gt;% select(-starts_with(&quot;raw_&quot;))</code></pre>
<p>Move <code>taxonID</code> to the first position:</p>
<pre class="r"><code>description_ext %&lt;&gt;% select(taxonID, everything())</code></pre>
<p>Sort on <code>taxonID</code>:</p>
<pre class="r"><code>description_ext %&lt;&gt;% arrange(taxonID)</code></pre>
<p>Preview data:</p>
<pre class="r"><code>description_ext %&gt;% 
  mutate(source = substr(source, 1, 20)) %&gt;% # Shorten source to make it easier to display
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["taxonID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["description"],"name":[2],"type":["chr"],"align":["left"]},{"label":["type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["source"],"name":[4],"type":["chr"],"align":["left"]},{"label":["language"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"rinse-pathways-checklist:taxon:01343a3f4feb581bf8c6d74354c7c561","2":"Europe (WGSRPD:1)","3":"native range","4":"http://www.europe-al","5":"en"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"Northern America (WGSRPD:7)","3":"native range","4":"http://www.cabi.org/","5":"en"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"Southern America (WGSRPD:8)","3":"native range","4":"http://www.cabi.org/","5":"en"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"cbd_2014_pathway:stowaway","3":"pathway","4":"http://www.cabi.org/","5":"en"},{"1":"rinse-pathways-checklist:taxon:047bea1a4e448882ec99d9a33cc3bbea","2":"cbd_2014_pathway:contaminant","3":"pathway","4":"http://www.cabi.org/","5":"en"},{"1":"rinse-pathways-checklist:taxon:04f9665a7644749f1e34d90ec21eb31f","2":"Asia","3":"native range","4":"http://www.nobanis.o","5":"en"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Save to CSV:</p>
<pre class="r"><code>write.csv(description_ext, file = dwc_description_file, na = &quot;&quot;, row.names = FALSE, fileEncoding = &quot;UTF-8&quot;)</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
